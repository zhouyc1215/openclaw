# é£ä¹¦é…ç½®å®ŒæˆæŠ¥å‘Š

## é…ç½®æ—¶é—´
2026-02-08 21:15

---

## âœ… é…ç½®ä¿¡æ¯

### åº”ç”¨å‡­è¯
- **App ID**: `cli_a90d40fc70b89bc2`
- **App Secret**: `jEFgKlvjq5c0aYRuh7YaecohSuV7IPUF`
- **Bot Open ID**: `ou_12a943a0e546083bb8c1dc9cb2e1872c`

### è¿æ¥é…ç½®
- **è¿æ¥æ¨¡å¼**: WebSocketï¼ˆé•¿è¿æ¥ï¼‰
- **åŸŸå**: feishuï¼ˆå›½å†…ç‰ˆï¼‰
- **çŠ¶æ€**: âœ… å·²å¯ç”¨å¹¶è¿è¡Œ

### Gateway ä¿¡æ¯
- **ç›‘å¬åœ°å€**: ws://127.0.0.1:18789
- **æ—¥å¿—æ–‡ä»¶**: /tmp/clawdbot/clawdbot-2026-02-08.log
- **è¿›ç¨‹çŠ¶æ€**: è¿è¡Œä¸­

---

## âœ… è¿æ¥çŠ¶æ€

```
Gateway reachable.
- Feishu default: enabled, configured, running
```

### WebSocket è¿æ¥æ—¥å¿—
```
[feishu] starting feishu provider (mode: websocket)
[feishu] bot open_id resolved: ou_12a943a0e546083bb8c1dc9cb2e1872c
[feishu] starting WebSocket connection...
[feishu] WebSocket client started
[ws] ws client ready
```

âœ… **é•¿è¿æ¥å·²æˆåŠŸå»ºç«‹ï¼**

---

## ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½®äº‹ä»¶è®¢é˜…

**ç°åœ¨å¯ä»¥å»é£ä¹¦å¼€æ”¾å¹³å°é…ç½®äº†**ï¼š

1. è®¿é—® [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. è¿›å…¥ä½ çš„åº”ç”¨åå°
3. ç‚¹å‡» **äº‹ä»¶ä¸å›è°ƒ**
4. äº‹ä»¶é…ç½®æ–¹å¼ï¼šé€‰æ‹© **ä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶**
5. æ­¤æ—¶åº”è¯¥ä¸ä¼šå†æŠ¥é”™äº†ï¼ˆå› ä¸ºé•¿è¿æ¥å·²å»ºç«‹ï¼‰
6. æ·»åŠ ä»¥ä¸‹äº‹ä»¶è®¢é˜…ï¼š

#### å¿…éœ€äº‹ä»¶
- âœ… `im.message.receive_v1` - æ¥æ”¶æ¶ˆæ¯ï¼ˆå¿…éœ€ï¼‰
- âœ… `im.message.message_read_v1` - æ¶ˆæ¯å·²è¯»
- âœ… `im.chat.member.bot.added_v1` - æœºå™¨äººè¿›ç¾¤
- âœ… `im.chat.member.bot.deleted_v1` - æœºå™¨äººè¢«ç§»å‡ºç¾¤

7. ç‚¹å‡» **ä¿å­˜**

---

### 2. é…ç½®æƒé™

ç¡®ä¿ä»¥ä¸‹æƒé™å·²ç”³è¯·å¹¶é€šè¿‡å®¡æ ¸ï¼š

#### åŸºç¡€æƒé™ï¼ˆå¿…éœ€ï¼‰
- âœ… `im:message` - å‘é€å’Œæ¥æ”¶æ¶ˆæ¯
- âœ… `im:message.p2p_msg:readonly` - è¯»å–ç§èŠæ¶ˆæ¯
- âœ… `im:message.group_at_msg:readonly` - æ¥æ”¶ç¾¤å†… @æ¶ˆæ¯
- âœ… `im:message:send_as_bot` - ä»¥æœºå™¨äººèº«ä»½å‘é€
- âœ… `im:resource` - ä¸Šä¼ ä¸‹è½½åª’ä½“æ–‡ä»¶

#### å¯é€‰æƒé™ï¼ˆç”¨äºå·¥å…·ï¼‰
- `contact:user.base:readonly` - è·å–ç”¨æˆ·ä¿¡æ¯
- `docx:document:readonly` - è¯»å–æ–‡æ¡£
- `drive:drive:readonly` - è®¿é—®äº‘ç©ºé—´
- `wiki:wiki:readonly` - è®¿é—®çŸ¥è¯†åº“
- `bitable:app:readonly` - è¯»å–å¤šç»´è¡¨æ ¼

---

### 3. å‘å¸ƒåº”ç”¨

1. åœ¨åº”ç”¨åå°ç‚¹å‡» **ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒ**
2. åˆ›å»ºç‰ˆæœ¬ï¼ˆè‡³å°‘å‘å¸ƒåˆ°æµ‹è¯•ç‰ˆæœ¬ï¼‰
3. è®¾ç½®å¯ç”¨èŒƒå›´ï¼ˆæ·»åŠ æµ‹è¯•ç”¨æˆ·ï¼‰
4. æäº¤å®¡æ ¸æˆ–ç›´æ¥å‘å¸ƒæµ‹è¯•ç‰ˆ

---

### 4. æµ‹è¯•æœºå™¨äºº

#### åœ¨é£ä¹¦ä¸­æœç´¢æœºå™¨äºº
1. æ‰“å¼€é£ä¹¦å®¢æˆ·ç«¯
2. åœ¨æœç´¢æ¡†ä¸­æœç´¢ä½ çš„æœºå™¨äººåç§°
3. æ‰¾åˆ°åç‚¹å‡»è¿›å…¥èŠå¤©

#### å‘é€æµ‹è¯•æ¶ˆæ¯
```
ä½ å¥½
```

#### é¢„æœŸå“åº”
æœºå™¨äººåº”è¯¥ä¼šå›å¤æ¶ˆæ¯ï¼ˆä½¿ç”¨ qwen2.5:1.5b æ¨¡å‹ï¼‰

---

## ğŸ”§ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹çŠ¶æ€
```bash
# æŸ¥çœ‹é¢‘é“çŠ¶æ€
pnpm clawdbot channels status

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
pnpm clawdbot status --deep

# æŸ¥çœ‹ Gateway çŠ¶æ€
pnpm clawdbot gateway status
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/clawdbot/clawdbot-2026-02-08.log

# æˆ–ä½¿ç”¨ clawdbot å‘½ä»¤
pnpm clawdbot logs gateway --tail 50
```

### é‡å¯ Gateway
```bash
# åœæ­¢
pnpm clawdbot gateway stop

# å¯åŠ¨
pnpm clawdbot gateway run

# æˆ–é‡å¯
pnpm clawdbot gateway restart
```

---

## ğŸ› ï¸ å·²æ³¨å†Œçš„å·¥å…·

Gateway å·²åŠ è½½ä»¥ä¸‹é£ä¹¦å·¥å…·ï¼š

1. **feishu_doc** - æ–‡æ¡£æ“ä½œ
   - è¯»å–æ–‡æ¡£
   - åˆ›å»ºæ–‡æ¡£
   - ç¼–è¾‘æ–‡æ¡£

2. **feishu_wiki** - çŸ¥è¯†åº“æ“ä½œ
   - åˆ—å‡ºç©ºé—´
   - æœç´¢èŠ‚ç‚¹
   - è·å–èŠ‚ç‚¹è¯¦æƒ…

3. **feishu_drive** - äº‘ç©ºé—´æ“ä½œ
   - åˆ—å‡ºæ–‡ä»¶å¤¹
   - è·å–æ–‡ä»¶ä¿¡æ¯
   - åˆ›å»º/ç§»åŠ¨/åˆ é™¤æ–‡ä»¶

4. **feishu_bitable** - å¤šç»´è¡¨æ ¼æ“ä½œï¼ˆ6ä¸ªå·¥å…·ï¼‰
   - è¯»å–è®°å½•
   - åˆ›å»ºè®°å½•
   - æ›´æ–°è®°å½•
   - åˆ é™¤è®°å½•
   - æŸ¥è¯¢å­—æ®µ
   - æ‰¹é‡æ“ä½œ

---

## ğŸ“Š å½“å‰é…ç½®

```json
{
  "channels": {
    "feishu": {
      "enabled": true,
      "appId": "cli_a90d40fc70b89bc2",
      "appSecret": "jEFgKlvjq5c0aYRuh7YaecohSuV7IPUF",
      "domain": "feishu",
      "groupPolicy": "open",
      "connectionMode": "websocket"
    }
  },
  "gateway": {
    "mode": "local",
    "port": 18789
  },
  "agents": {
    "defaults": {
      "workspace": "~/clawd",
      "model": {
        "primary": "ollama/qwen2.5:1.5b"
      }
    }
  }
}
```

---

## âš ï¸ é‡è¦æç¤º

### ä¿æŒ Gateway è¿è¡Œ
Gateway å¿…é¡»æŒç»­è¿è¡Œæ‰èƒ½ä¿æŒé•¿è¿æ¥ã€‚å¦‚æœ Gateway åœæ­¢ï¼Œéœ€è¦ï¼š
1. é‡æ–°å¯åŠ¨ Gateway
2. ç­‰å¾…é•¿è¿æ¥é‡æ–°å»ºç«‹
3. å¯èƒ½éœ€è¦åœ¨é£ä¹¦åå°é‡æ–°ä¿å­˜äº‹ä»¶è®¢é˜…é…ç½®

### åå°è¿è¡Œå»ºè®®

#### æ–¹æ³•1: ä½¿ç”¨ systemdï¼ˆæ¨èï¼‰
```bash
# Gateway å·²é…ç½®ä¸º systemd æœåŠ¡
sudo systemctl start clawdbot-gateway
sudo systemctl enable clawdbot-gateway  # å¼€æœºè‡ªå¯

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status clawdbot-gateway

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u clawdbot-gateway -f
```

#### æ–¹æ³•2: ä½¿ç”¨ tmux
```bash
# åˆ›å»ºä¼šè¯
tmux new -s clawdbot

# å¯åŠ¨ Gateway
pnpm clawdbot gateway run

# æŒ‰ Ctrl+B ç„¶åæŒ‰ D é€€å‡ºï¼ˆä¿æŒè¿è¡Œï¼‰

# é‡æ–°è¿æ¥
tmux attach -t clawdbot
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ”¶ä¸åˆ°æ¶ˆæ¯
**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] Gateway æ˜¯å¦åœ¨è¿è¡Œï¼Ÿ
- [ ] é•¿è¿æ¥æ˜¯å¦å·²å»ºç«‹ï¼Ÿ
- [ ] äº‹ä»¶è®¢é˜…æ˜¯å¦å·²é…ç½®ï¼Ÿ
- [ ] æƒé™æ˜¯å¦å·²é€šè¿‡å®¡æ ¸ï¼Ÿ
- [ ] åº”ç”¨æ˜¯å¦å·²å‘å¸ƒï¼Ÿ

**éªŒè¯å‘½ä»¤**ï¼š
```bash
pnpm clawdbot channels status
pnpm clawdbot status --deep
```

### é—®é¢˜2: è¿æ¥æ–­å¼€
**å¯èƒ½åŸå› **ï¼š
- ç½‘ç»œä¸ç¨³å®š
- Gateway é‡å¯
- é£ä¹¦æœåŠ¡å™¨ç»´æŠ¤

**è§£å†³æ–¹æ³•**ï¼š
```bash
# é‡å¯ Gateway
pnpm clawdbot gateway restart

# æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/clawdbot/clawdbot-2026-02-08.log
```

### é—®é¢˜3: å·¥å…·æ— æ³•ä½¿ç”¨
**åŸå› **ï¼šèµ„æºæœªåˆ†äº«ç»™æœºå™¨äºº

**è§£å†³æ–¹æ³•**ï¼š
1. äº‘ç©ºé—´ï¼šå°†æ–‡ä»¶å¤¹åˆ†äº«ç»™æœºå™¨äºº
2. çŸ¥è¯†åº“ï¼šå°†æœºå™¨äººæ·»åŠ ä¸ºæˆå‘˜
3. å¤šç»´è¡¨æ ¼ï¼šå°†è¡¨æ ¼åˆ†äº«ç»™æœºå™¨äºº

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **é£ä¹¦å¼€æ”¾å¹³å°**: https://open.feishu.cn/
- **æ’ä»¶æ–‡æ¡£**: ~/.clawdbot/extensions/feishu/README.md
- **Clawdbot æ–‡æ¡£**: https://docs.clawd.bot/
- **é…ç½®æŒ‡å—**: ~/feishu-websocket-setup-guide.md

---

## âœ… é…ç½®å®Œæˆæ£€æŸ¥è¡¨

- [x] App ID å’Œ App Secret å·²é…ç½®
- [x] è¿æ¥æ¨¡å¼è®¾ç½®ä¸º websocket
- [x] Gateway å·²å¯åŠ¨
- [x] é•¿è¿æ¥å·²å»ºç«‹
- [x] é£ä¹¦å·¥å…·å·²æ³¨å†Œ
- [ ] äº‹ä»¶è®¢é˜…å·²é…ç½®ï¼ˆéœ€è¦åœ¨é£ä¹¦åå°å®Œæˆï¼‰
- [ ] æƒé™å·²ç”³è¯·å¹¶é€šè¿‡
- [ ] åº”ç”¨å·²å‘å¸ƒ
- [ ] æµ‹è¯•æ¶ˆæ¯æ”¶å‘

---

**é…ç½®çŠ¶æ€**: âœ… Gateway ç«¯é…ç½®å®Œæˆ
**ä¸‹ä¸€æ­¥**: åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½®äº‹ä»¶è®¢é˜…å’Œæƒé™
**é¢„è®¡å®Œæˆæ—¶é—´**: 5-10åˆ†é’Ÿ

---

## ğŸ‰ æ€»ç»“

é£ä¹¦ Clawdbot çš„ Gateway ç«¯é…ç½®å·²å…¨éƒ¨å®Œæˆï¼

- âœ… åº”ç”¨å‡­è¯å·²é…ç½®
- âœ… WebSocket é•¿è¿æ¥å·²å»ºç«‹
- âœ… é£ä¹¦å·¥å…·å·²åŠ è½½
- âœ… Gateway æ­£å¸¸è¿è¡Œ

ç°åœ¨å¯ä»¥å»é£ä¹¦å¼€æ”¾å¹³å°å®Œæˆäº‹ä»¶è®¢é˜…å’Œæƒé™é…ç½®ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼
