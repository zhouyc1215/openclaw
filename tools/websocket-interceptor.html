<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenClaw WebSocket æ‹¦æˆªå™¨å·¥å…·</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 14px;
      }

      .content {
        padding: 30px;
      }

      .section {
        margin-bottom: 30px;
      }

      .section h2 {
        font-size: 20px;
        margin-bottom: 15px;
        color: #667eea;
        border-bottom: 2px solid #667eea;
        padding-bottom: 8px;
      }

      .method {
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 4px;
      }

      .method h3 {
        font-size: 18px;
        margin-bottom: 10px;
        color: #333;
      }

      .method ol,
      .method ul {
        margin-left: 20px;
        margin-top: 10px;
      }

      .method li {
        margin-bottom: 8px;
      }

      .code-block {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        font-family: "Courier New", monospace;
        font-size: 13px;
        line-height: 1.5;
        margin: 15px 0;
      }

      .bookmarklet {
        background: #fff3cd;
        border: 2px dashed #ffc107;
        padding: 20px;
        border-radius: 6px;
        margin: 15px 0;
      }

      .bookmarklet-link {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 12px 24px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: bold;
        margin-top: 10px;
        transition: background 0.3s;
      }

      .bookmarklet-link:hover {
        background: #5568d3;
      }

      .warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 15px 0;
        border-radius: 4px;
      }

      .warning strong {
        color: #856404;
      }

      .success {
        background: #d4edda;
        border-left: 4px solid #28a745;
        padding: 15px;
        margin: 15px 0;
        border-radius: 4px;
      }

      .success strong {
        color: #155724;
      }

      .button {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: background 0.3s;
        text-decoration: none;
      }

      .button:hover {
        background: #5568d3;
      }

      .button-secondary {
        background: #6c757d;
      }

      .button-secondary:hover {
        background: #5a6268;
      }

      .allowed-ids {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 15px;
      }

      .allowed-id {
        background: #e7f3ff;
        padding: 8px 12px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 13px;
        border: 1px solid #b3d9ff;
      }

      .allowed-id.recommended {
        background: #d4edda;
        border-color: #28a745;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ”§ OpenClaw WebSocket æ‹¦æˆªå™¨</h1>
        <p>ä¿®å¤ WebSocket è¿æ¥ä¸­çš„ client.id éªŒè¯é—®é¢˜</p>
      </div>

      <div class="content">
        <div class="section">
          <h2>ğŸ“‹ é—®é¢˜è¯´æ˜</h2>
          <p>
            å½“æµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„ Control UI æ—¶ï¼ŒWebSocket è¿æ¥ä¼šå› ä¸º client.id
            éªŒè¯å¤±è´¥è€Œè¢«æ‹’ç»ï¼ˆé”™è¯¯ç  1008ï¼‰ã€‚
          </p>
          <p>
            æœ¬å·¥å…·æä¾›äº†ä¸€ä¸ªä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡æ‹¦æˆª WebSocket è¿æ¥å¹¶ä¿®æ”¹ client.id ä¸ºæœåŠ¡å™¨å…è®¸çš„å€¼ã€‚
          </p>
        </div>

        <div class="section">
          <h2>ğŸš€ ä½¿ç”¨æ–¹æ³•</h2>

          <div class="method">
            <h3>æ–¹æ³• 1ï¼šæµè§ˆå™¨æ§åˆ¶å°ï¼ˆæ¨èï¼‰</h3>
            <ol>
              <li>è®¿é—® OpenClaw Control UI é¡µé¢</li>
              <li>æŒ‰ <kbd>F12</kbd> æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
              <li>åˆ‡æ¢åˆ° <strong>Console</strong> æ ‡ç­¾</li>
              <li>å¤åˆ¶ä¸‹é¢çš„ä»£ç å¹¶ç²˜è´´åˆ°æ§åˆ¶å°</li>
              <li>æŒ‰ <kbd>Enter</kbd> æ‰§è¡Œ</li>
              <li>åˆ·æ–°é¡µé¢ï¼ˆ<kbd>F5</kbd>ï¼‰</li>
            </ol>

            <button class="button" onclick="copyConsoleCode()">ğŸ“‹ å¤åˆ¶æ§åˆ¶å°ä»£ç </button>

            <div class="code-block" id="consoleCode" style="display: none">
              (function(){if(window.__OPENCLAW_WS_INTERCEPTOR_INSTALLED__){console.log('[OpenClaw]
              æ‹¦æˆªå™¨å·²å®‰è£…');return;}const
              t='openclaw-control-ui',o=window.WebSocket;window.WebSocket=function(e,n){console.log('[OpenClaw]
              åˆ›å»ºè¿æ¥:',e);const s=new o(e,n),c=s.send.bind(s);return s.send=function(e){try{const
              n=JSON.parse(e);if('req'===n.type&&'connect'===n.method){const
              e=n.params?.client?.id;if(console.log('[OpenClaw] åŸå§‹
              client.id:',e),n.params?.client){n.params.client.id=t,console.log('[OpenClaw] ä¿®æ”¹å
              client.id:',t);const e=JSON.stringify(n);return c(e)}}}catch(e){}return
              c(e)},s.addEventListener('open',()=>console.log('[OpenClaw]
              è¿æ¥å·²å»ºç«‹')),s.addEventListener('close',e=>{console.log('[OpenClaw]
              è¿æ¥å…³é—­:',e.code,e.reason),1008===e.code&&console.error('[OpenClaw] è¿æ¥è¢«æ‹’ç»
              (1008):',e.reason)}),s},Object.setPrototypeOf(window.WebSocket,o),window.WebSocket.prototype=o.prototype,window.__OPENCLAW_WS_INTERCEPTOR_INSTALLED__=!0,console.log('%c[OpenClaw]
              æ‹¦æˆªå™¨å·²å®‰è£…','color: green; font-weight: bold'),console.log('[OpenClaw]
              è¯·åˆ·æ–°é¡µé¢')})();
            </div>
          </div>

          <div class="method">
            <h3>æ–¹æ³• 2ï¼šæµè§ˆå™¨ä¹¦ç­¾ï¼ˆBookmarkletï¼‰</h3>
            <ol>
              <li>å°†ä¸‹é¢çš„é“¾æ¥æ‹–æ‹½åˆ°æµè§ˆå™¨ä¹¦ç­¾æ </li>
              <li>æˆ–å³é”®ç‚¹å‡»é“¾æ¥ï¼Œé€‰æ‹©"æ·»åŠ åˆ°ä¹¦ç­¾"</li>
              <li>è®¿é—® OpenClaw Control UI é¡µé¢</li>
              <li>ç‚¹å‡»ä¹¦ç­¾æ³¨å…¥æ‹¦æˆªå™¨</li>
              <li>åˆ·æ–°é¡µé¢ï¼ˆ<kbd>F5</kbd>ï¼‰</li>
            </ol>

            <div class="bookmarklet">
              <p><strong>æ‹–æ‹½æ­¤é“¾æ¥åˆ°ä¹¦ç­¾æ ï¼š</strong></p>
              <a
                href="javascript:(function(){if(window.__OPENCLAW_WS_INTERCEPTOR_INSTALLED__){console.log('[OpenClaw] æ‹¦æˆªå™¨å·²å®‰è£…');return;}const t='openclaw-control-ui',o=window.WebSocket;window.WebSocket=function(e,n){console.log('[OpenClaw] åˆ›å»ºè¿æ¥:',e);const s=new o(e,n),c=s.send.bind(s);return s.send=function(e){try{const n=JSON.parse(e);if('req'===n.type&&'connect'===n.method){const e=n.params?.client?.id;if(console.log('[OpenClaw] åŸå§‹ client.id:',e),n.params?.client){n.params.client.id=t,console.log('[OpenClaw] ä¿®æ”¹å client.id:',t);const e=JSON.stringify(n);return c(e)}}}catch(e){}return c(e)},s.addEventListener('open',()=>console.log('[OpenClaw] è¿æ¥å·²å»ºç«‹')),s.addEventListener('close',e=>{console.log('[OpenClaw] è¿æ¥å…³é—­:',e.code,e.reason),1008===e.code&&console.error('[OpenClaw] è¿æ¥è¢«æ‹’ç» (1008):',e.reason)}),s},Object.setPrototypeOf(window.WebSocket,o),window.WebSocket.prototype=o.prototype,window.__OPENCLAW_WS_INTERCEPTOR_INSTALLED__=!0,console.log('%c[OpenClaw] æ‹¦æˆªå™¨å·²å®‰è£…','color: green; font-weight: bold'),console.log('[OpenClaw] è¯·åˆ·æ–°é¡µé¢')})();"
                class="bookmarklet-link"
                >ğŸ”§ OpenClaw WS æ‹¦æˆªå™¨</a
              >
            </div>
          </div>
        </div>

        <div class="section">
          <h2>âœ… å…è®¸çš„ client.id å€¼</h2>
          <p>æœåŠ¡å™¨å½“å‰æ¥å—ä»¥ä¸‹ client.id å€¼ï¼š</p>
          <div class="allowed-ids">
            <div class="allowed-id recommended">openclaw-control-ui âœ“</div>
            <div class="allowed-id">webchat-ui</div>
            <div class="allowed-id">webchat</div>
            <div class="allowed-id">cli</div>
            <div class="allowed-id">gateway-client</div>
            <div class="allowed-id">openclaw-macos</div>
            <div class="allowed-id">openclaw-ios</div>
            <div class="allowed-id">openclaw-android</div>
            <div class="allowed-id">node-host</div>
            <div class="allowed-id">test</div>
            <div class="allowed-id">fingerprint</div>
            <div class="allowed-id">openclaw-probe</div>
          </div>
          <p style="margin-top: 15px">
            <small>âœ“ æ¨èä½¿ç”¨ <code>openclaw-control-ui</code></small>
          </p>
        </div>

        <div class="section">
          <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>
          <div class="warning">
            <strong>ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š</strong>
            è¿™ä¸ªæ‹¦æˆªå™¨åªæ˜¯ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢å‰éƒ½éœ€è¦é‡æ–°æ³¨å…¥ã€‚
          </div>
          <div class="warning">
            <strong>æ¨èåšæ³•ï¼š</strong> å»ºè®®æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆ<kbd>Ctrl + Shift + Delete</kbd
            >ï¼‰æˆ–å¼ºåˆ¶åˆ·æ–°ï¼ˆ<kbd>Ctrl + F5</kbd>ï¼‰æ¥åŠ è½½æœ€æ–°ç‰ˆæœ¬çš„ Control UIã€‚
          </div>
          <div class="warning">
            <strong>ä»…ç”¨äºè°ƒè¯•ï¼š</strong> æ­¤å·¥å…·ä»…ç”¨äºè°ƒè¯•å’Œæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒåº”è¯¥ä½¿ç”¨æ­£ç¡®ç‰ˆæœ¬çš„ Control
            UIã€‚
          </div>
        </div>

        <div class="section">
          <h2>ğŸ” éªŒè¯è¿æ¥</h2>
          <p>æˆåŠŸè¿æ¥åï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š</p>
          <div class="success">
            <ul>
              <li>âœ… Control UI ç•Œé¢æ­£å¸¸æ˜¾ç¤º</li>
              <li>âœ… æ²¡æœ‰ "disconnected (1008)" é”™è¯¯</li>
              <li>âœ… å¯ä»¥çœ‹åˆ° Gateway çŠ¶æ€ä¿¡æ¯</li>
              <li>âœ… å¯ä»¥ä¸ Agent è¿›è¡Œå¯¹è¯</li>
            </ul>
          </div>

          <p style="margin-top: 15px">åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š</p>
          <div class="code-block">
            [OpenClaw] æ‹¦æˆªå™¨å·²å®‰è£… [OpenClaw] åˆ›å»ºè¿æ¥: ws://10.71.1.116:18789/ [OpenClaw] åŸå§‹
            client.id: xxx [OpenClaw] ä¿®æ”¹å client.id: openclaw-control-ui [OpenClaw] è¿æ¥å·²å»ºç«‹
          </div>
        </div>

        <div class="section">
          <h2>ğŸ“š ç›¸å…³æ–‡æ¡£</h2>
          <ul>
            <li><a href="../WEBSOCKET-CONNECTION-FIX.md">WebSocket è¿æ¥ä¿®å¤æŒ‡å—</a></li>
            <li><a href="../WEBSOCKET-PROTOCOL-GUIDE.md">WebSocket åè®®è¯¦è§£</a></li>
            <li><a href="../OPENCLAW-ARCHITECTURE.md">OpenClaw æ¶æ„æ–‡æ¡£</a></li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      function copyConsoleCode() {
        const code = document.getElementById("consoleCode").textContent;
        navigator.clipboard
          .writeText(code)
          .then(() => {
            alert(
              "âœ… ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè¯·ï¼š\n1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰\n2. ç²˜è´´ä»£ç å¹¶æŒ‰ Enter\n3. åˆ·æ–°é¡µé¢ï¼ˆF5ï¼‰",
            );
          })
          .catch((err) => {
            alert("âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»£ç ");
            document.getElementById("consoleCode").style.display = "block";
          });
      }
    </script>
  </body>
</html>
